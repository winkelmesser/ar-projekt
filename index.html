<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>WebAR - Color Changer PWA</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <link rel="manifest" href="manifest.json">
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene 
    embedded 
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; debugUIEnabled: false; sourceWidth:640; sourceHeight:480; displayWidth: 640; displayHeight: 480;"
    renderer="antialias: false; precision: medium; logarithmicDepthBuffer: true;">
        
        <a-assets>
            <a-asset-item id="meinModell" src="assets/duck.glb"></a-asset-item>
        </a-assets>

        <a-marker preset="hiro">
            <a-entity 
                id="ente"
                class="clickable"
                gltf-model="#meinModell" 
                scale="0.5 0.5 0.5" 
                position="0 0 0"
                animation__click="property: scale; to: 0.6 0.6 0.6; dur: 150; startEvents: click"
                animation__reset="property: scale; to: 0.5 0.5 0.5; dur: 150; startEvents: animationcomplete__click">
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 999;">
    <button id="colorBtn" style="padding: 15px 30px; border-radius: 30px; border: none; background: #ff004c; color: white; font-weight: bold; font-size: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
        Farbe Ã¤ndern!
    </button>
</div>

<script>
    const ente = document.querySelector('#ente');
    const btn = document.querySelector('#colorBtn');

    function changeColor() {
        const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
        const mesh = ente.getObject3D('mesh');
        if (mesh) {
            mesh.traverse(node => {
                if (node.isMesh) node.material.color.set(randomColor);
            });
            // Kleiner Blitz-Effekt auf dem Button als Feedback
            btn.style.background = randomColor;
        }
    }

    // Jetzt reagiert die Ente auf den Klick im 3D-Raum UND auf den Button
    ente.addEventListener('click', changeColor);
    btn.addEventListener('click', changeColor);

    // Service Worker Registrierung (PWA Support)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js');
        });
}
    </script>
</body>
</html>